{% extends "layout.html" %}

{% block functions %}
    <script>
        function highlight(obj) {
            obj.style.background = "red"
        }
    </script>
    <script id="filterSource" type="text/html">
        {% if columnPickerElements is defined %}
            {% with pickerName = columnPickerName, pickerElements = columnPickerElements, selectedName = selectedColumns[i], onChangeFunc='highlight(this)' %}
                {% include 'picker.html' %}
            {% endwith %}
            {% with pickerName = 'condition', pickerElements = conditions, onChangeFunc='highlight(this)' %}
                {% include 'picker.html' %}
            {% endwith %}
            {% if inputName %}<input name={{ inputName }} onchange="highlight(this)"> {% endif %}
        {% endif %}
    </script>
    <script id="logicalConnectionSource" type="text/html">
        <br>
        {% with pickerName = logicalConnectionName, pickerElements = logicalConnections, onChangeFunc='highlight(this)' %}
            {% include 'picker.html' %}
        {% endwith %}
    </script>
    <script>
        function addFilter() {
            var filter = $("#filterSource").html();
            var t = $("conditionsTag").text();
            if (t.length > 250) {
                var log = $("#logicalConnectionSource").html();
                $("#conditionsTag").append(log);
            } else {
                $("#conditionsTag").append('<br>');
            }
            $("#conditionsTag").append(filter);
        }

        function deleteFilters() {
            $('conditionsTag').each(function () {
                $(this).remove();
            });
            $("#pConditions").append("<conditionsTag id = \"conditionsTag\"></conditionsTag>");
            form = document.getElementById('filtersForm');
            form.submit();
        }
    </script>
{% endblock %}

{% block header %}
    {{ super() }}
{% endblock %}

{% block content %}
    <form id="filtersForm" class="form-inline" method="GET">
        {% with pickerName = tablePickerName, pickerElements = tablePickerElements, selectedName = tableName, onChangeFunc = 'deleteFilters()' %}
            View table: {% include 'picker.html' %}
        {% endwith %}
        <br>
            <p id="pConditions"></p>
            <conditionsTag id="conditionsTag">
                Order by:
                {% with pickerName = orderPickerName, pickerElements = columnPickerElements, selectedName = selectedOrder, onChangeFunc='highlight(this)' %}
                    {% include 'picker.html' %}
                {% endwith %}
                <br>
                {% with pickerName = paginationPickerName, pickerElements = paginationPickerElements, selectedName = selectedPagination, onChangeFunc='highlight(this)' %}
                    Show {% include 'picker.html' %} entries
                {% endwith %}
                <br>
                Conditions:
                {% for i in range(selectedColumns|length) %}
                    <br>
                    {% if i != 0 %}
                        {% with pickerName = logicalConnectionName, pickerElements = logicalConnections, selectedName = selectedLogicalConnections[i], onChangeFunc='highlight(this)' %}
                            {% include 'picker.html' %}
                        {% endwith %}
                    {% endif %}
                    {% with pickerName = columnPickerName, pickerElements = columnPickerElements, selectedName = selectedColumns[i], onChangeFunc='highlight(this)' %}
                        {% include 'picker.html' %}
                    {% endwith %}
                    {% with pickerName = conditionsPickerName, pickerElements = conditions, selectedName = selectedConditions[i], onChangeFunc='highlight(this)' %}
                        {% include 'picker.html' %}
                    {% endwith %}
                    {% if inputName %}
                        <input name={{ inputName }} value="{{ selectedStrings[i] }}" onchange="highlight(this)">
                    {% endif %}
                {% endfor %}
            </conditionsTag>
            <button type="button" class="btn btn-default" onclick="addFilter()">Add Condition</button>
            <button type="button" class="btn btn-default" onclick="deleteFilters()">Delete All Conditions</button>
        <button type="submit" class="btn btn-default">{{ formButtonText }}</button>
        {{ table }}
        {% if tableName %}
            <div class="container">
                <h2>Viewing table {{ tableName }}:</h2>
                <div class="container" align="center">
                    {% with tableData = tableData %}
                    {% include 'tableGen.html' %}
                    {% endwith %}
                </div>
            </div>
        {% endif %}
    </form>
{% endblock %}