{% extends "layout.html" %}

{% block functions %}
    <script id="conditionSourceCode" type="text/html">
        <br>
        {% with pickerName = columnPickerName, pickerElements = columnPickerElements, selectedName = selectedColumns[i], onChangeFunc='highlight(this)' %}
            {% include 'picker.html' %}
        {% endwith %}
        {% with pickerName = 'condition', pickerElements = conditions, onChangeFunc='highlight(this)' %}
            {% include 'picker.html' %}
        {% endwith %}
        {% if inputName %}<input name={{ inputName }} onchange="highlight(this)"> {% endif %}
    </script>
    <script id="logicalConnectionSourceCode" type="text/html">
        <br>
        {% with pickerName = logicalConnectionName, pickerElements = logicalConnections, onChangeFunc='highlight(this)' %}
            {% include 'picker.html' %}
        {% endwith %}
    </script>
    <script>
        function highlight(obj) {
            obj.style.background = "yellow"
        }

        function addFilter() {
            var filter = '';
            if ($("#condition").length != 0) {
                filter += ($("#logicalConnectionSourceCode").html());
            }
            filter += $("#conditionSourceCode").html();
            $("#conditionsTag").append(filter);
        }

        function deleteFilters() {
            $('conditionsTag').each(function () {
                $(this).remove();
            });
            $("#pConditions").append("<conditionsTag id = \"conditionsTag\"></conditionsTag>");
            form = document.getElementById('filtersForm');
            form.submit();
        }

        function resetPage() {
            p = document.getElementById('{{ pagePickerName }}');
            p.value = 0;
            form = document.getElementById('filtersForm');
            form.submit();
        }
    </script>
    <script>
        $('#editRowModal').on('show.bs.modal', function(e) {
            console.log('a');
            var yourparameter = e.relatedTarget.dataset.yourparameter;
            // Do some stuff w/ it.
        });
    </script>
<script type="text/javascript">
    $(function () {
        $(".identifyingClass").click(function () {
            var my_id_value = $(this).data('id');
            $(".modal-body #idInput").val(my_id_value);
        })
    });
</script>
{% endblock %}

{% block header %}
    {{ super() }}
{% endblock %}

{% block content %}

    <button type="button" class="btn btn-default" data-toggle="modal" data-target="#addIntoTableModal">Add values
    </button>
    <form id="filtersForm" class="form-inline" method="GET">

        <div id="addIntoTableModal" class="modal fade" role="dialog">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title">Add values into table</h4>
                    </div>
                    <div class="modal-body">
                        {% for i in tableColumns %}
                            {{ i }}
                            <input name={{ addIntoTableInputsName }}>
                            <br>
                        {% endfor %}
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-default">Add values</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="editRowModal" class="modal fade" role="dialog">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title">Edit row</h4>
                    </div>
                    <div class="modal-body">
                    ID:
                    <input name = 'idInput' id = 'idInput' value = "" readonly />
                    <br>
                        {% for i in tableColumns %}
                            {{ i }}
                            <input name="{{ editInputName }}" id= "{{ editInputName }}" value = "" />
                            <br>
                        {% endfor %}
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-default">Apply changes</button>
                    </div>
                </div>
            </div>
        </div>

        {% with pickerName = tablePickerName, pickerElements = tablePickerElements, selectedName = tableName, onChangeFunc = 'deleteFilters()' %}
            View table: {% include 'picker.html' %}
        {% endwith %}
        <p id="pConditions" style="display:inline"></p>
        <conditionsTag id="conditionsTag">
            Order by:
            {% with pickerName = orderPickerName, pickerElements = columnPickerElements, selectedName = selectedOrder, onChangeFunc='highlight(this)' %}
                {% include 'picker.html' %}
            {% endwith %}
            {% with pickerName = paginationPickerName, pickerElements = paginationPickerElements, selectedName = selectedPagination, onChangeFunc='resetPage()' %}
                Show {% include 'picker.html' %} entries
            {% endwith %}
            <br>
            Conditions:
            {% for i in range(selectedColumns|length) %}
                <br>
                {% if i != 0 %}
                    {% with pickerName = logicalConnectionName, pickerElements = logicalConnections, selectedName = selectedLogicalConnections[i], onChangeFunc='highlight(this)' %}
                        {% include 'picker.html' %}
                    {% endwith %}
                    <br>
                {% endif %}
                {% with pickerName = columnPickerName, pickerElements = columnPickerElements, selectedName = selectedColumns[i], onChangeFunc='highlight(this)' %}
                    {% include 'picker.html' %}
                {% endwith %}
                {% with pickerName = conditionsPickerName, pickerElements = conditions, selectedName = selectedConditions[i], onChangeFunc='highlight(this)' %}
                    {% include 'picker.html' %}
                {% endwith %}
                {% if inputName %}
                    <input name={{ inputName }} value="{{ selectedStrings[i] }}" onchange="highlight(this)">
                {% endif %}
            {% endfor %}
        </conditionsTag>
        <button type="button" class="btn btn-default" onclick="addFilter()">Add Condition</button>
        <button type="button" class="btn btn-default" onclick="deleteFilters()">Delete All Conditions</button>
        <button type="submit" class="btn btn-default">{{ formButtonText }}</button>
        {{ table }}
        {% if incorrectQuery is defined %}
            <br><br>
            <div class="alert alert-warning">
                <center><strong>Incorrect Query!</strong> Try Again.</center>
            </div>
        {% endif %}
        <br>
        <input type="button" class="btn btn-default" onclick="location.href='{{ addIntoTableQuery }}'"
               value="Add into table"/>
        {% if tableData is defined %}
            <div class="container">
                <div class="container" align="center">
                    {% with tableData = tableData %}
                        {% include 'tableGen.html' %}
                    {% endwith %}
                </div>
            </div>
        {% endif %}
    </form>
{% endblock %}